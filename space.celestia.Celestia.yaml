id: space.celestia.Celestia
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: celestia
rename-appdata-file: celestia.appdata.xml
rename-desktop-file: celestia.desktop
rename-icon: celestia
finish-args:
  - --device=dri
  - --filesystem=home
  - --share=ipc
  - --share=network
  - --socket=x11
modules:
  - name: celestia
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/CelestiaProject/Celestia/archive/1.6.2/Celestia-1.6.2.tar.gz
        sha512: c26d2d22fa1d5bf0edf4cc0bea229732b3391233e9d212d2e323d4d32d8f333684e16c7dcf96442e90af0892793335ea7683dbc78ab0e8f365cb8e2475652952
      - type: patch
        path: celestia-1.6.2-beta3-lua-5.4.patch
      - type: file
        path: celestia.appdata.xml
      - type: shell
        commands:
          - autoreconf -fiv
    config-opts:
      - --with-gtk
      - --with-lua
    post-install:
      - for n in 16 22 32 48; do install -p -m 644 -D src/celestia/kde/data/hi${n}-app-celestia.png $FLATPAK_DEST/share/icons/hicolor/${n}x${n}/apps/celestia.png; done
      - install -p -m 644 -D src/celestia/gtk/data/celestia.svg $FLATPAK_DEST/share/icons/hicolor/scalable/apps/celestia.svg
      - install -D -m0644 celestia.appdata.xml $FLATPAK_DEST/share/metainfo/celestia.appdata.xml
    cleanup:
      - /share/pixmaps/celestia.png
    modules:
      - shared-modules/gtk2/gtk2.json
      - shared-modules/lua5.4/lua-5.4.json
      - gtkglext/gtkglext.yaml
