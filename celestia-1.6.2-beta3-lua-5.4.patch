diff -up Celestia-1.6.2-beta3/configure.ac.lua54 Celestia-1.6.2-beta3/configure.ac
--- Celestia-1.6.2-beta3/configure.ac.lua54	2020-06-10 03:22:53.000000000 -0400
+++ Celestia-1.6.2-beta3/configure.ac	2020-07-13 14:16:08.599339105 -0400
@@ -376,13 +376,14 @@ AC_ARG_WITH([lua],
 
 if (test "$enable_lua" != "no"); then
 	LUA_VER=0
+	PKG_CHECK_MODULES(LUA, lua5.4 >= 5.4.0, LUA_VER=0x050400, [
 	PKG_CHECK_MODULES(LUA, lua5.3 >= 5.3.0, LUA_VER=0x050300, [
 	PKG_CHECK_MODULES(LUA, lua >= 5.3.0, LUA_VER=0x050300, [
 	PKG_CHECK_MODULES(LUA, lua5.2 >= 5.2.0, LUA_VER=0x050200, [
 	PKG_CHECK_MODULES(LUA, lua >= 5.2.0, LUA_VER=0x050200, [
 	PKG_CHECK_MODULES(LUA, lua5.1 >= 5.1.0, LUA_VER=0x050100, [
 	PKG_CHECK_MODULES(LUA, lua >= 5.1.0, LUA_VER=0x050100, AC_MSG_RESULT([no])) ]
-	) ] ) ] ) ] ) ] )
+	) ] ) ] ) ] ) ] ) ] )
 	if (test "$LUA_VER" = "0"); then
 		if (test "x$enable_lua" != "xauto"); then
 			AC_ERROR([Lua not found (explicitly enabled)!])
diff -up Celestia-1.6.2-beta3/src/celestia/celx.cpp.lua54 Celestia-1.6.2-beta3/src/celestia/celx.cpp
--- Celestia-1.6.2-beta3/src/celestia/celx.cpp.lua54	2020-07-13 15:39:06.725303570 -0400
+++ Celestia-1.6.2-beta3/src/celestia/celx.cpp	2020-07-13 15:40:47.950709672 -0400
@@ -669,7 +669,10 @@ static int resumeLuaThread(lua_State *L,
     //if (!lua_checkstack(co, narg))
     //   luaL_error(L, "too many arguments to resume");
     lua_xmove(L, co, narg);
-#if LUA_VERSION_NUM >= 502
+#if LUA_VERSION_NUM >= 504
+    int nres;
+    status = lua_resume(co, NULL, narg, &nres);
+#elif LUA_VERSION_NUM >= 502
     status = lua_resume(co, NULL, narg);
 #else
     status = lua_resume(co, narg);
